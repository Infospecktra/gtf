/* Generated by Together */
package org.yang.customized.gtf.services.projectManager.web.PDA;

import org.yang.web.view.controls.WebControlBuilder;
import org.yang.web.view.controls.WebControl;
import org.yang.web.controller.GenericBean;
import org.yang.web.view.controls.jsStyle.UIForm;
import org.yang.web.view.controls.jsStyle.TextField;
import org.yang.web.view.controls.jsStyle.PassElement;
import org.yang.web.view.controls.jsStyle.SelectElement;
import org.yang.web.view.controls.jsStyle.TextAreaElement;
import org.yang.web.view.controls.jsStyle.ButtonElement;
import org.yang.util.DateFormatter;
import java.util.Date;
import org.yang.customized.gtf.services.dataAccess.Stage;
import org.yang.web.view.controls.jsStyle.InformationForm;
import java.util.HashMap;
import java.util.Iterator;
import org.yang.services.dataAccess.Data;
import org.yang.web.view.controls.jsStyle.misc.MessageDisplayingBanner;
import org.yang.web.view.controls.jsStyle.Photo;
import org.yang.web.view.controls.jsStyle.panel.GenericPanel;
import org.yang.web.view.controls.jsStyle.panel.TabPanelElement;
import org.yang.customized.gtf.services.projectManager.ProjectManager;
import java.util.ArrayList;
import java.util.Set;

public class PDAProjectNotesFormBuilder implements WebControlBuilder
{
   boolean isClient = true;
   String stageOwnerType = "server";
   Stage currentStage = null;

   public WebControl build(GenericBean bean) throws Exception
   {
      PDAProjectNotesBean pdaBean = (PDAProjectNotesBean)bean;
      String appBase = pdaBean.getAppBase();
      String codeBase = pdaBean.getGuiBase();


      return createPanel(pdaBean, appBase, codeBase);
   }

   private WebControl createPanel(PDAProjectNotesBean pdaBean, String appBase, String codeBase) throws Exception
   {
      String currentTab = pdaBean.getProjectType();
      String[] allTabs = pdaBean.getAllAvailableProjectTypes();
      if(null==currentTab||"".equals(currentTab))
      {
        if(null==allTabs||0==allTabs.length)
        {
           MessageDisplayingBanner banner = new MessageDisplayingBanner();
           banner.setText("Current there is no project available for you.");
           banner.setColor("#c0c0c0");
           return banner;
        }
        currentTab = allTabs[0];
      }
      GenericPanel panel = new GenericPanel();
      panel.setId("projectsTreePanel");
      panel.setDisableForm(true);
      panel.setText("Managing ongoing project list.");
      panel.setCodeBase(codeBase);
      panel.setColor("#C0C0C0");
      panel.setActionLink(appBase + "/projectsList.wf");

      TabPanelElement projectTab = null;
      String aTab = null;
      for(int i=0; i<allTabs.length; i++)
      {
         // project list
         aTab = (String)allTabs[i];
         projectTab = new TabPanelElement();
         projectTab.setId(aTab);
         projectTab.setText(aTab);
         projectTab.setCodeBase(appBase + codeBase);
         projectTab.setColor("#F0F0F0");
         projectTab.setTabSwitchingLink("/wf/stageNotes.wf?actiontype=changeDataOwner&targetOwner=" + aTab);

         if(aTab.equals(currentTab))
         {
            projectTab.addASubcontrol(new InformationForm());//createForm(stageBean, appBase + codeBase, aTab));
            projectTab.setOnFocus(true);
         }
         else
            projectTab.setOnFocus(false);

         panel.addASubcontrol(projectTab);
      }

      return panel;
   }

/*
   private InformationForm createForm(StageNotesBean stageBean, String codeBase, String dataOwnerName) throws Exception
   {
      isClient = stageBean.gotPermit("ProjectManager", stageBean.getProjectType(), ProjectManager.CLIENT);
      stageOwnerType = currentStage.getOwnerType();

//System.out.println("---------------> is Client:" + isClient);
//System.out.println("---------------> stage owner type:" + stageOwnerType);

      InformationForm form = new InformationForm();
      form.setCaption("Stage Nots");
      form.setActionLink(stageBean.getAppBase() + "/stageNotes.wf");
      form.setId("stageNotes");

      if(Stage.DONE!=currentStage.getStatus())
      {
         ButtonElement save = new ButtonElement();
         save.setAction("javascript:submitForm('stageNotes','update')");
         save.setAlt("Update stage notes");
         save.setName("save");
         save.setOffIcon(codeBase + "/images/English/btn_update.gif");
         save.setOnIcon(codeBase + "/images/English/btn_update_on.gif");
         form.addAButton(save);
      }

      if(Stage.DONE!=currentStage.getStatus())
      {
         // 1. if this stage is owned by both this button shall be shown.
         // 2. if this stage is owned by client and you are client this button shall be shown
         // 3. if this stage is owned by server and you are not client this button shall be shown
         if("both".equals(stageOwnerType)||
            (ProjectManager.CLIENT.equals(stageOwnerType)&&isClient)||
            ("server".equals(stageOwnerType)&&!isClient))
         {
            ButtonElement doneB = new ButtonElement();
            doneB.setAction("javascript:submitForm('stageNotes','done')");
            doneB.setAlt("Stage done");
            doneB.setName("done");
            doneB.setOffIcon(codeBase + "/images/English/btn_done.gif");
            doneB.setOnIcon(codeBase + "/images/English/btn_done_on.gif");
            form.addAButton(doneB);
         }
      }

      ButtonElement help = new ButtonElement();
      help.setAction("javascript:top.topFrame.openSWHelpWindow('" + codeBase + "/help/English/help.jsp?right=projects.htm#project')");
      help.setName("help");
      help.setOffIcon(codeBase + "/images/English/btn_help.gif");
      help.setOnIcon(codeBase + "/images/English/btn_help_on.gif");
      help.setAlt("Help");
      form.addAButton(help);

      String dateFormat = currentStage.getDateDisplayFormat();

      // done date (client)
      TextField doneDate = new TextField();
      doneDate.setTitle(currentStage.getDateDisplayName());
      doneDate.setId("doneDate");
      doneDate.setName("doneDate");
      long done = currentStage.getDoneDate();

      if(-1==done)
         doneDate.setValue("not done yet");
      else
         doneDate.setValue(DateFormatter.getDateTimeString(new Date(done), dateFormat));
      doneDate.setDisplayOnly(true);
      form.addASubcontrol(doneDate);

      // last update date
      if(!isClient)
      {
         TextField lastUpdateDate = new TextField();
         lastUpdateDate.setTitle("Last update date");
         lastUpdateDate.setId("lastUpdateDate");
         lastUpdateDate.setName("lastUpdateDate");
         long lastUpdate = currentStage.getLastUpdateDate();

         if(-1==lastUpdate)
            lastUpdateDate.setValue("no update yet");
         else
            lastUpdateDate.setValue(DateFormatter.getDateTimeString(new Date(lastUpdate), dateFormat));
         lastUpdateDate.setDisplayOnly(true);
         form.addASubcontrol(lastUpdateDate);
      }

      //
      Data[] datas = currentStage.getDatas();
      TextField data = null;
      if(null!=datas)
      {
         String name = null;
         String value = null;
         for(int i=0; i<datas.length; i++)
         {
            System.out.println("data name:" + datas[i].getName() + ", data avail. for client:" + datas[i].getAvailForClient());
            // client
            if(isClient&&!datas[i].getAvailForClient())
               continue;

            name = datas[i].getName();
            value = datas[i].getValue(dataOwnerName);
            if(!"photoBinary".equals(datas[i].getType()))
            {
               data = new TextField();
               data.setTitle(datas[i].getDisplayName());
               data.setId("datas_" + name);
               data.setName("datas_" + name);
               data.setValue(value);
               data.setUnit(datas[i].getUnit());
               data.setSize("60");
               // 1. if you are client but this stage is belong to client -> read only
               // 2. for all other situations -> read/write
               if(isClient&&!"client".equals(stageOwnerType))
                  data.setDisplayOnly(true);
               else
                 data.setDisplayOnly(false);
               form.addASubcontrol(data);
            }
            else
            {
               Photo photo = new Photo();
               photo.setTitle(datas[i].getDisplayName());
               if(null==value||"".equals(value))
               {
                  photo.setAlt("Attaching photo data.");
                  photo.setAction("/wf/photoUpload.wf?actiontype=upload");
               }
               else
               {
                  photo.setAlt("Browse photo data.");
                  photo.setAction("/wf/photoUpload.wf?actiontype=load&id=" + value);
               }
               photo.setName("save");
               photo.setOffIcon(codeBase + "/images/English/btn_update.gif");
               photo.setOnIcon(codeBase + "/images/English/btn_update_on.gif");
               form.addASubcontrol(photo);
            }
         }
      }

      // note
      if(!isClient||ProjectManager.CLIENT.equals(stageOwnerType))
      {
         TextAreaElement note = new TextAreaElement();
         note.setTitle("Note history");
         note.setId("note");
         note.setName("note");

         if(Stage.DONE!=currentStage.getStatus())
         {
            note.setRows("5");
         }
         else
         {
            note.setRows("10");
         }
         note.setCols("60");
         note.setValue(currentStage.getNote());
         note.setIsReadOnly(true);
         form.addASubcontrol(note);

         if(Stage.DONE!=currentStage.getStatus())
         {
            TextAreaElement updateNote = new TextAreaElement();
            updateNote.setTitle("Update Note");
            updateNote.setId("updateNote");
            updateNote.setName("updateNote");
            updateNote.setRows("10");
            updateNote.setCols("60");
            updateNote.setValue("");
            updateNote.setIsReadOnly(false);
            form.addASubcontrol(updateNote);
         }
      }

      return form;
   }
   */
}