/* Generated by Together */

package org.yang.services.messageBus.FileSystem;

import java.io.FileWriter;
import org.yang.services.messageBus.MessageTransmitter;
import org.yang.services.messageBus.Route;
import org.yang.services.messageBus.Message;
import org.yang.services.messageBus.MessageTransmitException;

final public class FileMessageTransmitterImpl implements MessageTransmitter
{
   static final long serialVersionUID = 3439536522284252199L;

   String repositoryPath = null;
   FileNamePolicy policy = null;
   int count = 0;

   public FileMessageTransmitterImpl(Route rt)
   {
      if(null==(repositoryPath = rt.getProperty("repository-path")))
         repositoryPath = "./";
      policy = new FileNamePolicy(rt.getProperty("file-name"));
   }

   public void transmit(Message msg) throws MessageTransmitException
   {
      String filename = repositoryPath + policy.getFilename(msg.getId());

      try
      {
         FileWriter writer = new FileWriter(filename);
         writer.write(msg.getPayload().toString());
         writer.flush();
         writer.close();
         count++;
      }
      catch(Exception e)
      {
         throw new MessageTransmitException("Unable to save message to file : " + filename);
      }
   }

   public int getMessageCount()
   {
      return count;
   }
}